_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[13],{JP4i:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/experimentations/ardennes",function(){return r("bBHS")}])},bBHS:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return S}));var n=r("nKUr"),a=r("o0o1"),i=r.n(a),c=r("KQm4"),s=r("rePB"),o=r("HaE+"),l=r("q1tI"),u=r("EUZL"),d=r("CafY"),j=r("RPyZ"),b=r("aIN1"),p=r("GHpc"),O=r("vRNQ"),f=r.n(O),h=r("i0Yj"),m=r("PQ1l"),x=r("jwbB");function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function D(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach((function(t){Object(s.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var w=Object(m.b)("Exp\xe9rimentation Ardennes - CNAF - B\xe9n\xe9ficiaire"),_="https://www.rdv-solidarites.fr",N=_+"/api/v1/users";function S(){var e=Object(l.useState)(null),t=e[0],r=(e[1],Object(l.useReducer)(w,[],m.a)),a=(r[0],r[1]),s=Object(l.useState)(null),O=s[0],v=s[1],S=Object(l.useState)(!1),g=S[0],y=S[1],E=Object(l.useState)(0),R=E[0],I=E[1],P=Object(l.useState)(!1),k=P[0],A=P[1],V=Object(l.useState)({tokenId:"",uid:"",client:""}),L=V[0],F=V[1];Object(l.useEffect)((function(){t&&U(t)}),[t]),Object(l.useEffect)((function(){O&&!1===g&&(O.forEach((function(e,t){""!=e["ID RDV"]&&H(e["ID RDV"],t)})),y(!0))}),[O]);function C(e,t){return M.apply(this,arguments)}function M(){return(M=Object(o.a)(i.a.mark((function e(t,r){var n,a,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=N+"/".concat(t,"/invite"),e.next=3,Object(h.a)(n,L);case 3:(a=e.sent).invitation_url&&((s=Object(c.a)(O))[r].Invitation=a.invitation_url,s[r]["Date d'invitation"]=Object(x.c)(new Date),v(s));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e,t){return B.apply(this,arguments)}function B(){return(B=Object(o.a)(i.a.mark((function e(t,r){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=N+"/".concat(t),e.next=3,Object(h.a)(n,r);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e,t){return z.apply(this,arguments)}function z(){return(z=Object(o.a)(i.a.mark((function e(t,r){var n,a,s,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T(t,L);case 2:n=e.sent,a=Object(c.a)(O),n.user.invitation_created_at&&(s=n.user.invitation_created_at.substring(0,10),s=new Date(s),a[r]["Date d'invitation"]=Object(x.c)(s)),n.user.invitation_accepted_at&&(o=n.user.invitation_accepted_at.substring(0,10),o=new Date(o),a[r]["Date d'inscription"]=Object(x.c)(o)),v(a);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(){return(J=Object(o.a)(i.a.mark((function e(t,r){var n,a,s,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.ADRESSE+" - "+t["CODE POSTAL"]+" "+t.VILLE,a={first_name:t.PRENOM,last_name:t.NOM,email:t.MAIL,phone_number:t.TELEPHONE.replace(/\s+/g,""),birth_date:Object(x.d)(t["DATE DE NAISSANCE"]),address:n,caisse_affiliation:"caf",affiliation_number:t["N\xb0CAF"],organisation_ids:["249"]},e.next=4,Object(h.a)(N,L,"POST",JSON.stringify(a));case 4:s=e.sent,o=Object(c.a)(O),s.user?(o[r]["ID RDV"]=s.user.id,v(o),C(s.user.id,r)):s.errors&&s.errors.email&&"taken"===s.errors.email[0].error?(o[r]["ID RDV"]=s.errors.email[0].id,v(o),H(s.errors.email[0].id,r),alert("Un compte associ\xe9 \xe0 cet email existe d\xe9j\xe0")):s.errors&&s.errors.email&&"invalid"===s.errors.email[0].error?alert("L'adresse mail n'est pas valide"):s.errors&&s.errors.first_name&&"d\xe9j\xe0 utilis\xe9"===s.errors.first_name[0].error?alert("La cr\xe9ation du compte a \xe9chou\xe9. L'utilisateur semble exister mais n'a pu \xeatre r\xe9cup\xe9r\xe9."):s.errors&&s.errors[0]&&"forbidden"===s.errors[0].base?alert("Votre compte agent RDV-Solidarit\xe9s ne vous permet pas d'effectuer cette action."):s.errors&&s.errors[0]&&alert(s.errors[0]);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var U=function(){var e=Object(o.a)(i.a.mark((function e(t){var r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return I(t.size),r=new Date,e.next=5,new Promise((function(e){var n=new FileReader;n.onload=function(n){var i=new Uint8Array(n.target.result),s=u.read(i,{type:"array",cellDates:!0,dateNF:"dd/mm/yyyy"}),o=s.Sheets[s.SheetNames[0]],l=u.utils.decode_range(o["!ref"]);l.s.c=0,l.e.c=21;var d=u.utils.encode_range(l),j=u.utils.sheet_to_json(o,{blankrows:!1,raw:!1,defval:"",range:d});null==(j=j.map((function(e){return Object(c.a)(Object.keys(e)).reduce((function(t,r){return t[r.replace(/[\n\r]+/g," ")]=e[r],t}),{})})))&&setIsPending(!1),y(!1),v(j),a({type:"append",item:{timestamp:(new Date).toISOString().slice(0,19),duration:new Date-r,filename:t.name,fileSize:t.size,fileLines:j.length}}),e()},n.readAsArrayBuffer(t)}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(n.jsx)(d.a,{className:f.a.container,handleFile:U,children:Object(n.jsxs)("main",{className:f.a.main,children:[Object(n.jsx)("h1",{className:f.a.title,children:"Exp\xe9rimentation Ardennes"}),!k&&Object(n.jsx)("div",{className:f.a.create,children:Object(n.jsx)(p.a,{handleLogin:function(e,t,r){F(D(D({},L),{},{tokenId:e,uid:t,client:r})),A(!0)},rdvUrl:_})}),k&&Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)(j.a,{handleFile:U,fileSize:R,pendingMessage:"R\xe9cup\xe9ration des informations, merci de patienter"}),O&&Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)("h2",{className:f.a.subtitle,children:"B\xe9n\xe9ficiaires RSA"}),0==O.length&&Object(n.jsx)("p",{className:f.a.description,children:"Aucun b\xe9n\xe9ficiaire dans le fichier"}),O.length>0&&Object(n.jsxs)(n.Fragment,{children:[Object(n.jsxs)("table",{children:[Object(n.jsxs)("thead",{children:[Object(n.jsxs)("tr",{children:[Object(n.jsx)("th",{rowSpan:"2",children:"Nom"}),Object(n.jsx)("th",{rowSpan:"2",children:"Pr\xe9nom"}),Object(n.jsx)("th",{rowSpan:"2",children:"Mail"}),Object(n.jsx)("th",{rowSpan:"2",children:"T\xe9l\xe9phone"}),Object(n.jsx)("th",{rowSpan:"2",children:"ID RDV-Solidarit\xe9s"}),Object(n.jsx)("th",{colSpan:"3",children:"Invitation"})]}),Object(n.jsxs)("tr",{children:[Object(n.jsx)("th",{colSpan:"1",children:"Dernier envoi le"}),Object(n.jsx)("th",{colSpan:"1",children:"Date d'inscription"}),Object(n.jsx)("th",{colSpan:"1",children:"Action"})]})]}),Object(n.jsx)("tbody",{children:O.map((function(e,t){return Object(n.jsxs)("tr",{children:[Object(n.jsx)("td",{className:f.a.center,children:e.NOM}),Object(n.jsx)("td",{className:f.a.center,children:e.PRENOM}),Object(n.jsx)("td",{className:f.a.center,children:e.MAIL}),Object(n.jsx)("td",{className:f.a.center,children:e.TELEPHONE}),""===e["ID RDV"]&&Object(n.jsx)("td",{className:f.a.center,children:Object(n.jsx)("button",{onClick:function(){return function(e,t){return J.apply(this,arguments)}(e,t)},children:"Cr\xe9er un compte"})}),""!==e["ID RDV"]&&Object(n.jsx)("td",{className:f.a.center,children:e["ID RDV"]}),Object(n.jsx)("td",{className:f.a.center,children:e["Date d'invitation"]}),Object(n.jsx)("td",{className:f.a.center,children:e["Date d'inscription"]}),""!==e["ID RDV"]&&Object(n.jsx)("td",{className:f.a.center,children:Object(n.jsxs)("button",{onClick:function(){return C(e["ID RDV"],t)},children:[""!==e["Date d'invitation"]&&"Reg\xe9n\xe9rer invitation",""===e["Date d'invitation"]&&"G\xe9n\xe9rer invitation"]})}),""===e["ID RDV"]&&Object(n.jsx)("td",{className:f.a.center})]},t)}))})]}),Object(n.jsx)("button",{className:f.a.button,onClick:function(){var e=u.utils.book_new(),t=u.utils.json_to_sheet(O);u.utils.book_append_sheet(e,t,"DIVERGENCES"),u.writeFile(e,"ardennes_rsa_".concat(Object(x.b)(new Date),".xlsx"))},children:"Reg\xe9n\xe9rer fichier"})]})]})]}),Object(n.jsx)(b.a,{subject:"Exp\xe9rimentation Ardennes",pourquoi:"Quel est l'objectif de cette exp\xe9rimentation\xa0?",text:Object(n.jsx)(n.Fragment,{children:Object(n.jsx)("p",{className:f.a.text,children:"Faciliter le travail des agents du d\xe9partement et tester l'utilisation de l'application RDV-Solidarit\xe9s pour acc\xe9l\xe9rer la prise du premier rendez-vous d'orientation."})})})]})})}}},[["JP4i",0,2,8,7,6,1,3,4,5]]]);