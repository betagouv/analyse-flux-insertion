_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[14],{"9Dz5":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return _}));var r=n("nKUr"),a=n("o0o1"),i=n.n(a),c=n("KQm4"),s=n("rePB"),o=n("HaE+"),u=n("q1tI"),l=n("20a2"),d=n("EUZL"),j=n("CafY"),p=n("RPyZ"),b=n("aIN1"),h=n("GHpc"),O=n("vRNQ"),f=n.n(O),m=n("i0Yj"),x=n("PQ1l"),v=n("jwbB");function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?D(Object(n),!0).forEach((function(t){Object(s.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var N=Object(x.b)("Exp\xe9rimentation Ardennes - CNAF - B\xe9n\xe9ficiaire");function _(){var e=Object(l.useRouter)().pathname.includes("demo"),t=e?"107":"249",n=e?"https://demo.rdv-solidarites.fr":"https://www.rdv-solidarites.fr",a=n+"/api/v1/users",s=Object(u.useState)(null),O=s[0],D=(s[1],Object(u.useReducer)(N,[],x.a)),_=(D[0],D[1]),E=Object(u.useState)(null),g=E[0],y=E[1],S=Object(u.useState)(!1),R=S[0],A=S[1],I=Object(u.useState)(0),k=I[0],C=I[1],P=Object(u.useState)(!1),F=P[0],V=P[1],L=Object(u.useState)({tokenId:"",uid:"",client:""}),T=L[0],U=L[1];Object(u.useEffect)((function(){O&&Z(O)}),[O]),Object(u.useEffect)((function(){g&&!1===R&&(g.forEach((function(e,t){""!=e["ID RDV"]&&H(e["ID RDV"],t)})),A(!0))}),[g]);function M(e,t){return z.apply(this,arguments)}function z(){return(z=Object(o.a)(i.a.mark((function e(t,n){var r,s,o,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a+"/".concat(t,"/invite"),e.next=3,Object(m.a)(r,T);case 3:s=e.sent,o=Object(c.a)(g),(u=o[n].MAIL)&&u.length>0?o[n]["Lien d'invitation"]=s.invitation_url:o[n]["Code d'invitation"]=s.invitation_token,o[n]["Date d'invitation"]=Object(v.e)(new Date),y(o);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e){return B.apply(this,arguments)}function B(){return(B=Object(o.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a+"/".concat(t),e.next=3,Object(m.a)(n,T);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e,t){return Q.apply(this,arguments)}function Q(){return(Q=Object(o.a)(i.a.mark((function e(t,n){var r,a,s,o;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,q(t);case 2:r=e.sent,a=Object(c.a)(g),r.user.invitation_created_at&&(s=r.user.invitation_created_at.substring(0,10),s=new Date(s),a[n]["Date d'invitation"]=Object(v.e)(s)),r.user.invitation_accepted_at&&(o=r.user.invitation_accepted_at.substring(0,10),o=new Date(o),a[n]["Date d'inscription"]=Object(v.e)(o)),y(a);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var G=function(e){return e.ADRESSE+" - "+e["CODE POSTAL"]+" "+e.VILLE};function J(e,t,n){return K.apply(this,arguments)}function K(){return(K=Object(o.a)(i.a.mark((function e(t,n,r){var a,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,q(r);case 2:(a=e.sent)&&a.user&&a.user.first_name.toUpperCase()===t.PRENOM.toUpperCase()&&a.user.last_name.toUpperCase()===t.NOM.toUpperCase()&&a.user.birth_date===Object(v.a)(Object(v.f)(t["DATE DE NAISSANCE"]))&&a.user.address.toUpperCase()===G(t).toUpperCase()?((s=Object(c.a)(g))[n]["ID RDV"]=r,y(s),H(r,n),alert("Un compte associ\xe9 \xe0 cet email existe d\xe9j\xe0")):Y(t,n,!1,r);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(e,t){return X.apply(this,arguments)}function X(){return(X=Object(o.a)(i.a.mark((function e(n,r){var s,o,u,l,d,j,p=arguments;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=!(p.length>2&&void 0!==p[2])||p[2],o=p.length>3&&void 0!==p[3]?p[3]:null,u=G(n),[13,15].includes(n["N\xb0CAF"].trim().length)&&(n["N\xb0CAF"]=""),l={first_name:n.PRENOM,last_name:n.NOM,phone_number:n.TELEPHONE.replace(/\s+/g,""),birth_date:Object(v.a)(Object(v.f)(n["DATE DE NAISSANCE"])),address:u,caisse_affiliation:"caf",affiliation_number:n["N\xb0CAF"],organisation_ids:[t],responsible_id:o},!0===s&&(l.email=n.MAIL),e.next=8,Object(m.a)(a,T,"POST",JSON.stringify(l));case 8:d=e.sent,j=Object(c.a)(g),d.user?(j[r]["ID RDV"]=d.user.id,y(j),M(d.user.id,r)):d.errors&&d.errors.email&&"taken"===d.errors.email[0].error?J(n,r,d.errors.email[0].id):d.errors&&d.errors.email&&"invalid"===d.errors.email[0].error?Y(n,r,!1):d.errors&&d.errors.first_name&&"d\xe9j\xe0 utilis\xe9"===d.errors.first_name[0].error?alert("La cr\xe9ation du compte a \xe9chou\xe9. L'utilisateur semble exister mais n'a pu \xeatre r\xe9cup\xe9r\xe9."):d.errors&&d.errors[0]&&"forbidden"===d.errors[0].base?alert("Votre compte agent RDV-Solidarit\xe9s ne vous permet pas d'effectuer cette action."):d.errors&&d.errors[0]&&alert(d.errors[0]);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Z=function(){var e=Object(o.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return C(t.size),n=new Date,e.next=5,new Promise((function(e){var r=new FileReader;r.onload=function(r){var a=new Uint8Array(r.target.result),i=d.read(a,{type:"array",cellDates:!0,dateNF:"dd/mm/yyyy"}),s=i.Sheets[i.SheetNames[0]],o=d.utils.sheet_to_json(s,{blankrows:!1,raw:!1,defval:""});o=o.map((function(e){return Object(c.a)(Object.keys(e)).reduce((function(t,n){return t[n.replace(/[\n\r]+/g," ")]=e[n],t}),{})})),A(!1),y(o),_({type:"append",item:{timestamp:(new Date).toISOString().slice(0,19),duration:new Date-n,filename:t.name,fileSize:t.size,fileLines:o.length}}),e()},r.readAsArrayBuffer(t)}));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(r.jsx)(j.a,{className:f.a.container,handleFile:Z,children:Object(r.jsxs)("main",{className:f.a.main,children:[Object(r.jsx)("h1",{className:f.a.title,children:"Exp\xe9rimentation Ardennes"}),!F&&Object(r.jsx)("div",{className:f.a.create,children:Object(r.jsx)(h.a,{handleLogin:function(e,t,n){U(w(w({},T),{},{tokenId:e,uid:t,client:n})),V(!0)},rdvUrl:n})}),F&&Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(p.a,{handleFile:Z,fileSize:k,pendingMessage:"R\xe9cup\xe9ration des informations, merci de patienter"}),g&&Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)("h2",{className:f.a.subtitle,children:"B\xe9n\xe9ficiaires RSA"}),0==g.length&&Object(r.jsx)("p",{className:f.a.description,children:"Aucun b\xe9n\xe9ficiaire dans le fichier"}),g.length>0&&Object(r.jsxs)(r.Fragment,{children:[Object(r.jsxs)("table",{children:[Object(r.jsxs)("thead",{children:[Object(r.jsxs)("tr",{children:[Object(r.jsx)("th",{rowSpan:"2",children:"Date"}),Object(r.jsx)("th",{rowSpan:"2",children:"Nom"}),Object(r.jsx)("th",{rowSpan:"2",children:"Pr\xe9nom"}),Object(r.jsx)("th",{rowSpan:"2",children:"Mail"}),Object(r.jsx)("th",{rowSpan:"2",children:"T\xe9l\xe9phone"}),Object(r.jsx)("th",{rowSpan:"2",children:"ID RDV-Solidarit\xe9s"}),Object(r.jsx)("th",{colSpan:"3",children:"Invitation"})]}),Object(r.jsxs)("tr",{children:[Object(r.jsx)("th",{colSpan:"1",children:"Dernier envoi le"}),Object(r.jsx)("th",{colSpan:"1",children:"Date d'inscription"}),Object(r.jsx)("th",{colSpan:"1",children:"Action"})]})]}),Object(r.jsx)("tbody",{children:Object(c.a)(g).reverse().map((function(e,t){return Object(r.jsx)(u.Fragment,{children:""!==e.DATE&&Object(r.jsxs)("tr",{children:[Object(r.jsx)("td",{className:f.a.center,children:e.DATE}),Object(r.jsx)("td",{className:f.a.center,children:e.NOM}),Object(r.jsx)("td",{className:f.a.center,children:e.PRENOM}),Object(r.jsx)("td",{className:f.a.center,children:e.MAIL}),Object(r.jsx)("td",{className:f.a.center,children:e.TELEPHONE}),""===e["ID RDV"]&&Object(r.jsx)("td",{className:f.a.center,children:Object(r.jsx)("button",{onClick:function(){return Y(e,g.length-t-1)},children:"Cr\xe9er un compte"})}),""!==e["ID RDV"]&&Object(r.jsx)("td",{className:f.a.center,children:e["ID RDV"]}),Object(r.jsx)("td",{className:f.a.center,children:e["Date d'invitation"]}),Object(r.jsx)("td",{className:f.a.center,children:e["Date d'inscription"]}),""!==e["ID RDV"]&&Object(r.jsx)("td",{className:f.a.center,children:Object(r.jsxs)("button",{onClick:function(){return M(e["ID RDV"],g.length-t-1)},children:[""!==e["Date d'invitation"]&&"Reg\xe9n\xe9rer invitation",""===e["Date d'invitation"]&&"G\xe9n\xe9rer invitation"]})}),""===e["ID RDV"]&&Object(r.jsx)("td",{className:f.a.center})]})},t)}))})]}),Object(r.jsx)("button",{className:f.a.button,onClick:function(){var e=d.utils.book_new(),t=d.utils.json_to_sheet(g);d.utils.book_append_sheet(e,t,"DIVERGENCES"),d.writeFile(e,"ardennes_rsa_".concat(Object(v.d)(new Date),".xlsx"))},children:"Reg\xe9n\xe9rer fichier"})]})]})]}),Object(r.jsx)(b.a,{subject:"Exp\xe9rimentation Ardennes",pourquoi:"Quel est l'objectif de cette exp\xe9rimentation\xa0?",text:Object(r.jsx)(r.Fragment,{children:Object(r.jsx)("p",{className:f.a.text,children:"Faciliter le travail des agents du d\xe9partement et tester l'utilisation de l'application RDV-Solidarit\xe9s pour acc\xe9l\xe9rer la prise du premier rendez-vous d'orientation."})})})]})})}},aIN1:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n("nKUr"),a=n("oRLf"),i=n("vRNQ"),c=n.n(i);function s(e){var t=e.pourquoi,n=e.text,i=e.subject;return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)("h2",{id:"pourquoi",className:c.a.subtitle,children:t}),n,Object(r.jsxs)("p",{className:c.a.description,children:["Un probl\xe8me, une question ? Contactez-nous \xe0"," ",Object(r.jsx)(a.a,{subject:i,children:"data.insertion@beta.gouv.fr"})]})]})}},i0Yj:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n("o0o1"),a=n.n(r),i=n("HaE+");function c(e,t){return s.apply(this,arguments)}function s(){return(s=Object(i.a)(a.a.mark((function e(t,n){var r,i,c,s,o=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>2&&void 0!==o[2]?o[2]:"GET",i=o.length>3&&void 0!==o[3]?o[3]:null,e.next=4,fetch(t,{method:r,headers:{"Content-Type":"application/json","access-token":n.tokenId,uid:n.uid,client:n.client},body:i});case 4:return c=e.sent,e.next=7,c.json();case 7:return s=e.sent,e.abrupt("return",s);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},lODh:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/experimentations/ardennes-demo",function(){return n("9Dz5")}])}},[["lODh",0,2,8,7,5,1,3,4,6]]]);