_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[13],{FB2r:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/identification-beneficiaires",function(){return n("gPHx")}])},gFYM:function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var r=n("KQm4"),i=n("1OyB"),a=n("vuIU"),s=n("Ji7U"),c=n("md7G"),o=n("foSv"),l=n("sLyh"),u=n("GYdj");function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(o.a)(e);if(t){var i=Object(o.a)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Object(c.a)(this,n)}}var f=function(e){Object(s.a)(n,e);var t=d(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"retrieveApplicant",value:function(e){return this.dom.getElementsByTagName("Personne")[e]}},{key:"retrieveApplication",value:function(e){return this.dom.getElementsByTagName("InfosFoyerRSA")[e]}},{key:"retrievePartitions",value:function(){for(var e=this,t={},n={},i={},a={},s={},c=0;c<this.applicationsCount;c++){var o=this.retrieveApplication(c),l=o.getElementsByTagName("DTDEMRSA")[0].innerHTML;t[l]=(t[l]||0)+1,this.updatePartition(n,o.getElementsByTagName("ETATDOSRSA")),this.updatePartition(i,o.getElementsByTagName("TOPPERSDRODEVORSA"));var u=o.getElementsByTagName("Personne");Object(r.a)(u).forEach((function(t){var n;e.updatePartition(s,t.getElementsByTagName("ROLEPERS")),"2"==(null===(n=t.getElementsByTagName("ETATDOSRSA")[0])||void 0===n?void 0:n.innerHTML)&&e.updatePartition(a,t.getElementsByTagName("TOPPERSDRODEVORSA")[0].innerHTML)}))}return{applicationDatesPartition:t,droitsPartition:n,devoirsPartition:i,droitsEtDevoirsPartition:a,applicantsRolesCount:s}}},{key:"updatePartition",value:function(e,t){return t[0]&&(e[t[0].innerHTML]=(e[t[0].innerHTML]||0)+1,e.Total=(e.Total||0)+1),e}},{key:"applicationsCount",get:function(){return this.dom.getElementsByTagName("InfosFoyerRSA").length}},{key:"newApplicantsPersonalData",get:function(){for(var e=[],t=0;t<this.applicantsCount;t++){var n,r=this.retrieveApplicant(t);if("1"==(null===(n=r.getElementsByTagName("TOPPERSDRODEVORSA")[0])||void 0===n?void 0:n.innerHTML)){var i,a,s,c,o,l=null===(i=r.getElementsByTagName("NOM")[0])||void 0===i?void 0:i.innerHTML,d=null===(a=r.getElementsByTagName("PRENOM")[0])||void 0===a?void 0:a.innerHTML,f=u.a[null===(s=r.getElementsByTagName("ROLEPERS")[0])||void 0===s?void 0:s.innerHTML],j=null===(c=r.parentNode.getElementsByTagName("NUMDEMRSA")[0])||void 0===c?void 0:c.innerHTML,p=null===(o=r.parentNode.getElementsByTagName("NIR")[0])||void 0===o?void 0:o.innerHTML;e.push({rsaApplicationNumber:j,socialSecurityNumber:p,lastName:l,firstName:d,role:f})}}return e}}]),n}(l.a)},gPHx:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return g}));var r=n("nKUr"),i=n("Ff2n"),a=n("KQm4"),s=n("rePB"),c=n("CafY"),o=n("RPyZ"),l=n("vRNQ"),u=n.n(l),d=n("GYdj"),f=n("q1tI"),j=n("PQ1l"),p=n("gFYM"),b=n("YzSY"),m=n("Svyj"),O=n("jwbB");function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){Object(s.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var v=Object(j.b)("Test - CNAF - Identification nouveaux demandeurs");function g(){var e=Object(f.useState)(0),t=e[0],n=e[1],s=Object(f.useState)(!1),l=s[0],h=s[1],g=Object(f.useReducer)(v,[],j.a),x=g[0],E=g[1],y=Object(f.useState)("b\xe9n\xe9ficiaires"),P=y[0],R=y[1],T=function(e){"b\xe9n\xe9ficiaires"==P?D(e):S(e)},A=function(){h(!1),alert("Vous n'avez pas upload\xe9 un flux ".concat(P," !"))},D=function(e){h(!0),n(e.size);var t=new FileReader;t.onload=function(t){var n=new p.a(t.target.result);if("B\xe9n\xe9ficiaires"!==d.c[n.origin])return A();h(!1),E({type:"append",item:{applicantsPersonalData:n.newApplicantsPersonalData,fileName:e.name}})},t.readAsText(e)},S=function(e){h(!0),n(e.size);var t=new FileReader;t.onload=function(e){var t=new b.a(e.target.result);if("Instructions"!==d.c[t.origin])return A();h(!1),E({type:"replace",items:M(t.applicantsPersonalData)})},t.readAsText(e)},M=function(e){return x.map((function(t){return N(N({},t),{},{applicantsPersonalData:w(e,t.applicantsPersonalData)})}))},w=function(e,t){return t.map((function(t){return N(N({},e.find((function(e){return e.rsaApplicationNumber===t.rsaApplicationNumber}))),t)}))},B=x.some((function(e){return e.applicantsPersonalData.some((function(e){return e.mailAddress}))})),F=x.some((function(e){return e.applicantsPersonalData.some((function(e){return e.phoneNumber}))}));return Object(r.jsx)(c.a,{className:u.a.container,handleFile:T,children:Object(r.jsxs)("main",{className:u.a.main,children:[Object(r.jsx)("h1",{children:"Identifiez les nouveaux demandeurs \xe0 l'aide des flux CNAF"}),Object(r.jsxs)("ol",{children:[Object(r.jsxs)("li",{style:"b\xe9n\xe9ficiaires"===P?{fontWeight:"bold"}:{},children:['Uploadez le ou les fichiers "b\xe9n\xe9ficiaires" pour identifier les nouveaux demandeurs'," ","(< 100 Mo) "]}),Object(r.jsx)("br",{}),Object(r.jsxs)("li",{children:[" ",'Une fois les flux b\xe9n\xe9ficiaires upload\xe9s, cliquez sur "Passer aux flux d\'instructions"']}),Object(r.jsx)("br",{}),Object(r.jsx)("li",{style:"instructions"===P?{fontWeight:"bold"}:{},children:'Uploadez le ou les fichiers "instructions" associ\xe9s pour r\xe9cup\xe9rer les donn\xe9es de contact des demandeurs.'})]}),Object(r.jsx)(o.a,{handleFile:T,isPending:l,fileSize:t,uploadMessage:["Glissez et d\xe9posez les flux ",Object(r.jsx)("strong",{children:P})," \xe0 analyser ou s\xe9lectionnez-les."],pendingMessage:"Traitement en cours, merci de patienter."}),x&&x.length>0&&Object(r.jsxs)(r.Fragment,{children:["b\xe9n\xe9ficiaires"===P&&Object(r.jsx)("button",{className:u.a.button,onClick:function(){return R("instructions")},children:"Passer aux flux instructions"}),"instructions"===P&&Object(r.jsx)("button",{className:u.a.button,onClick:function(){return R("b\xe9n\xe9ficiaires")},children:"Revenir aux flux b\xe9n\xe9ficiaires"}),Object(r.jsxs)("div",{className:u.a.button_group,children:[Object(r.jsx)("div",{style:{marginRight:"20px"},children:Object(r.jsxs)("button",{className:u.a.button,onClick:function(){var e=[],t=B||F;x.forEach((function(n){n.applicantsPersonalData.forEach((function(r){var i,s;t&&(null!==(i=r.mailAddress)&&void 0!==i||(r.mailAddress=""),null!==(s=r.phoneNumber)&&void 0!==s||(r.phoneNumber=""));e.push([].concat(Object(a.a)(Object.values(r)),[n.fileName]))}))}));var n=t?["NUMERO DEMANDE RSA","NIR","NOM","PRENOM","ROLE","EMAIL","TELEPHONE","FICHIER SOURCE"]:["NUMERO DEMANDE RSA","NIR","NOM","PRENOM","ROLE","FICHIER SOURCE"],r="nouveaux_demandeurs_rsa_"+Object(O.a)()+".csv";Object(m.a)(r,e,n)},children:[" ","Exporter au format CSV"," "]})}),Object(r.jsx)("div",{children:Object(r.jsx)("button",{className:u.a.button,onClick:function(){E({type:"reset"}),R("b\xe9n\xe9ficiaires")},children:"Vider l'historique"})})]}),Object(r.jsxs)("table",{className:u.a.margin_side,children:[Object(r.jsx)("thead",{children:Object(r.jsxs)("tr",{children:[Object(r.jsx)("th",{children:"Num\xe9ro de demande RSA"}),Object(r.jsx)("th",{children:"NIR"}),Object(r.jsx)("th",{children:"Nom"}),Object(r.jsx)("th",{children:"Pr\xe9nom"}),Object(r.jsx)("th",{children:"R\xf4le"}),B&&Object(r.jsx)("th",{children:"Email"}),F&&Object(r.jsx)("th",{children:"T\xe9l\xe9phone"}),Object(r.jsx)("th",{children:"Ficher source "})]})}),Object(r.jsx)("tbody",{children:x.flatMap((function(e){var t=e.applicantsPersonalData,n=Object(i.a)(e,["applicantsPersonalData"]);return t.map((function(e){return N(N({},e),n)}))})).map((function(e){var t=e.fileName,n=Object(i.a)(e,["fileName"]),a=[n.rsaApplicationNumber,n.lastName,n.firstName,n.role,t].join("-");return Object(r.jsxs)("tr",{children:[Object(r.jsx)("td",{children:n.rsaApplicationNumber}),Object(r.jsx)("td",{children:n.socialSecurityNumber}),Object(r.jsx)("td",{children:n.lastName}),Object(r.jsx)("td",{children:n.firstName}),Object(r.jsx)("td",{children:n.role}),B&&Object(r.jsx)(r.Fragment,{children:Object(r.jsx)("td",{children:n.mailAddress||""})}),F&&Object(r.jsx)(r.Fragment,{children:Object(r.jsx)("td",{children:n.phoneNumber||""})}),Object(r.jsx)("td",{children:t})]},a)}))})]})]})]})})}}},[["FB2r",0,2,1,3,4]]]);