_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[18],{"3Ztg":function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/lecteur/cnaf/instruction",function(){return n("VtO9")}])},RHh3:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n("s4An");function a(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function r(e,t,n){return(r=a()?Reflect.construct:function(e,t,n){var a=[null];a.push.apply(a,t);var r=new(Function.bind.apply(e,a));return n&&Object(i.a)(r,n.prototype),r}).apply(null,arguments)}},VtO9:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return v}));var i=n("nKUr"),a=n("KQm4"),r=n("q1tI"),c=(n("g4pe"),n("2zrp")),s=n("CafY"),l=n("RPyZ"),o=n("aIN1"),u=n("vRNQ"),h=n.n(u),d=n("GYdj"),p=n("mPdc"),j=n("RHh3"),m=n("1OyB"),f=n("vuIU"),b=n("Ji7U"),O=n("md7G"),g=n("foSv");function x(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=Object(g.a)(e);if(t){var a=Object(g.a)(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return Object(O.a)(this,n)}}var y=function(e){Object(b.a)(n,e);var t=x(n);function n(){return Object(m.a)(this,n),t.apply(this,arguments)}return Object(f.a)(n,[{key:"filterApplicationsByEmailAuthorizationLevel",value:function(e){return this.applications.filter((function(t){var n=t.getElementsByTagName("AUTORUTIADRELEC")[0];return t.getElementsByTagName("ADRELEC").length&&n&&n.innerHTML==e}))}},{key:"filterApplicationsByPhoneAuthorizationLevel",value:function(e){return this.applications.filter((function(t){var n=t.getElementsByTagName("AUTORUTITEL")[0];return t.getElementsByTagName("NUMTEL").length&&n&&n.innerHTML==e}))}},{key:"applications",get:function(){return Object(j.a)(Array,Object(a.a)(this.dom.getElementsByTagName("InfoDemandeRSA")))}},{key:"applicants",get:function(){return Object(j.a)(Array,Object(a.a)(this.dom.getElementsByTagName("Personne")))}},{key:"applicationsCount",get:function(){return this.dom.getElementsByTagName("InfoDemandeRSA").length}},{key:"withEmail",get:function(){return this.applications.filter((function(e){return e.getElementsByTagName("ADRELEC").length}))}},{key:"withUsableEmail",get:function(){return this.filterApplicationsByEmailAuthorizationLevel("A")}},{key:"withForbiddenEmailUsage",get:function(){return this.filterApplicationsByEmailAuthorizationLevel("R")}},{key:"withoutEmailUsage",get:function(){return this.filterApplicationsByEmailAuthorizationLevel("I")}},{key:"withPhone",get:function(){return this.applications.filter((function(e){return e.getElementsByTagName("NUMTEL").length}))}},{key:"withUsablePhone",get:function(){return this.filterApplicationsByPhoneAuthorizationLevel("A")}},{key:"withForbiddenPhoneUsage",get:function(){return this.filterApplicationsByPhoneAuthorizationLevel("R")}},{key:"withoutPhoneUsage",get:function(){return this.filterApplicationsByPhoneAuthorizationLevel("I")}},{key:"withDSP",get:function(){return this.applications.filter((function(e){return e.getElementsByTagName("DonneesSocioProfessionnelles").length}))}},{key:"applicantsPersonalData",get:function(){return this.applicants.map((function(e){var t,n,i,a,r,c,s,l=null===(t=e.getElementsByTagName("NOM")[0])||void 0===t?void 0:t.innerHTML,o=null===(n=e.getElementsByTagName("PRENOM")[0])||void 0===n?void 0:n.innerHTML,u=d.a[null===(i=e.getElementsByTagName("ROLEPERS")[0])||void 0===i?void 0:i.innerHTML],h=null===(a=e.parentNode.getElementsByTagName("NUMDEMRSA")[0])||void 0===a?void 0:a.innerHTML,p=null===(r=e.parentNode.getElementsByTagName("ADRELEC")[0])||void 0===r?void 0:r.innerHTML,j=null===(c=e.parentNode.getElementsByTagName("NUMTEL")[0])||void 0===c?void 0:c.innerHTML;return{rsaApplicationNumber:h,socialSecurityNumber:null===(s=e.parentNode.getElementsByTagName("NIR")[0])||void 0===s?void 0:s.innerHTML,lastName:l,firstName:o,role:u,mailAddress:p,phoneNumber:j}}))}}]),n}(n("sLyh").a),E=n("jwbB"),N=Object(p.b)("Test - CNAF - Instruction"),w=!1;function v(){var e=Object(r.useReducer)(N,[],p.a),t=e[0],n=e[1],u=Object(r.useState)(!1),j=u[0],m=u[1],f=Object(r.useState)(0),b=f[0],O=f[1],g=Object(r.useCallback)((function(e){n({type:"reset",items:e})})),x=function(e){O(e.size),m(!0);var t=new Date,i=new FileReader;i.onload=function(i){var a=new y(i.target.result);m(!1),n({type:"append",item:{seed:Math.random(),timestamp:(new Date).toISOString().slice(0,19),duration:new Date-t,filename:e.name,fileSize:e.size,fileDatetime:a.fileDatetime,frequency:a.frequency,origin:a.origin,parseError:a.parseError,total:a.applicationsCount,email:{total:a.withEmail.length,withAutorisation:a.withUsableEmail.length,withExplicitRefusal:a.withForbiddenEmailUsage.length,withoutAutorisationDetails:a.withoutEmailUsage.length},phone:{total:a.withPhone.length,withAutorisation:a.withUsableEmail.length,withExplicitRefusal:a.withForbiddenEmailUsage.length,withoutAutorisationDetails:a.withoutEmailUsage.length},withDSP:a.withDSP.length,applicantsPersonalData:a.applicantsPersonalData}})},i.readAsText(e)},v=function(e){return Math.round(e)};return Object(i.jsxs)(s.a,{className:h.a.container,handleFile:x,children:[Object(i.jsx)(c.a,{category:"Instruction",onRunRefresh:g}),Object(i.jsxs)("main",{className:h.a.main,children:[Object(i.jsxs)("h1",{className:h.a.title,children:["Lecteur de fichier",Object(i.jsx)("br",{}),"\xab Instruction \xbb de la CNAF"]}),Object(i.jsx)(l.a,{handleFile:x,isPending:j,fileSize:b}),t&&t.length>0&&Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("h2",{className:h.a.subtitle,children:"Historique"}),Object(i.jsxs)("table",{children:[Object(i.jsxs)("thead",{children:[Object(i.jsxs)("tr",{children:[Object(i.jsx)("th",{rowSpan:"2",children:"Date"}),Object(i.jsx)("th",{rowSpan:"2",children:"Fichier"}),w,w,Object(i.jsx)("th",{rowSpan:"2",children:"Date du fichier"}),Object(i.jsx)("th",{rowSpan:"2",children:"Fr\xe9quence"}),Object(i.jsx)("th",{rowSpan:"2",children:"Nature"}),Object(i.jsx)("th",{rowSpan:"2",children:"Dossiers"}),Object(i.jsx)("th",{colSpan:"8",children:"avec email"}),Object(i.jsx)("th",{colSpan:"8",children:"avec t\xe9l\xe9phone"}),Object(i.jsx)("th",{colSpan:"2",rowSpan:"2",children:"DSP (%)"}),Object(i.jsx)("th",{rowSpan:"2",children:"Erreur"})]}),Object(i.jsxs)("tr",{children:[Object(i.jsx)("th",{colSpan:"2",children:"# (%)"}),Object(i.jsx)("th",{colSpan:"2",children:"et autorisation (%)"}),Object(i.jsx)("th",{colSpan:"2",children:"refus explicit (%)"}),Object(i.jsx)("th",{colSpan:"2",children:Object(i.jsx)("abbr",{title:"Balise AUTORUTIADRELEC pr\xe9sente et \xe9gale \xe0 'I'",children:"inconnu explicit (I) (%)"})}),Object(i.jsx)("th",{colSpan:"2",children:"# (%)"}),Object(i.jsx)("th",{colSpan:"2",children:"et autorisation (%)"}),Object(i.jsx)("th",{colSpan:"2",children:"refus explicit (%)"}),Object(i.jsx)("th",{colSpan:"2",children:Object(i.jsx)("abbr",{title:"Balise AUTORUTITEL pr\xe9sente et \xe9gale \xe0 'I'",children:"inconnu explicit (I) (%)"})})]})]}),Object(i.jsx)("tbody",{children:t.map((function(e){return Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{children:e.timestamp}),Object(i.jsx)("td",{children:e.filename}),w,w,Object(i.jsx)("td",{children:e.fileDatetime}),Object(i.jsx)("td",{children:"".concat(e.frequency," (").concat(d.b[e.frequency]||"?",")")}),Object(i.jsx)("td",{children:"".concat(e.origin," (").concat(d.c[e.origin]||"?",")")}),Object(i.jsx)("td",{className:h.a.numeric,children:e.total}),Object(i.jsx)("td",{className:h.a.numeric,children:e.email.total}),Object(i.jsx)("td",{className:"shrink",children:v(e.email.total/e.total*100)}),Object(i.jsx)("td",{className:h.a.numeric,children:e.email.withAutorisation}),Object(i.jsx)("td",{className:"shrink",children:v(e.email.withAutorisation/e.total*100)}),Object(i.jsx)("td",{className:h.a.numeric,children:e.email.withExplicitRefusal}),Object(i.jsx)("td",{className:"shrink",children:v(e.email.withExplicitRefusal/e.total*100)}),Object(i.jsx)("td",{className:h.a.numeric,children:e.email.withoutAutorisationDetails}),Object(i.jsx)("td",{className:"shrink",children:v(e.email.withoutAutorisationDetails/e.total*100)}),Object(i.jsx)("td",{className:h.a.numeric,children:e.phone.total}),Object(i.jsx)("td",{className:"shrink",children:v(e.phone.total/e.total*100)}),Object(i.jsx)("td",{className:h.a.numeric,children:e.phone.withAutorisation}),Object(i.jsx)("td",{className:"shrink",children:v(e.phone.withAutorisation/e.total*100)}),Object(i.jsx)("td",{className:h.a.numeric,children:e.phone.withExplicitRefusal}),Object(i.jsx)("td",{className:"shrink",children:v(e.phone.withExplicitRefusal/e.total*100)}),Object(i.jsx)("td",{className:h.a.numeric,children:e.phone.withoutAutorisationDetails}),Object(i.jsx)("td",{className:"shrink",children:v(e.phone.withoutAutorisationDetails/e.total*100)}),Object(i.jsx)("td",{className:h.a.numeric,children:e.withDSP}),Object(i.jsx)("td",{className:"shrink",children:v(e.withDSP/e.total*100)}),Object(i.jsx)("td",{children:e.parseError?"Oui":"Non"})]},"".concat(e.timestamp,"-").concat(e.filename,"-").concat(e.seed))}))})]}),Object(i.jsx)("button",{className:h.a.button,onClick:function(){return n({type:"reset"})},children:"Vider l'historique"}),Object(i.jsx)("button",{className:h.a.button,onClick:function(){var e=[];t.forEach((function(t){t.applicantsPersonalData.forEach((function(n){e.push([].concat(Object(a.a)(Object.values(n)),[t.filename]))}))}));!function(e,t){var n="data:text/csv;charset=utf-8,"+(arguments.length>2&&void 0!==arguments[2]?arguments[2]:[]).join(",")+"\n"+t.map((function(e){return e.join(",")})).join("\n"),i=encodeURI(n),a=document.createElement("a");a.setAttribute("href",i),a.setAttribute("download",e),document.body.appendChild(a),a.click()}("flux_insertion_donnees_personnelles_"+Object(E.a)()+".csv",e,["NUMERO DEMANDE RSA","NIR","NOM","PRENOM","ROLE","EMAIL","TELEPHONE","FICHIER SOURCE"])},children:"Exporter les donn\xe9es de contacts"})]}),Object(i.jsx)(o.a,{subject:"Flux instruction CNAF",pourquoi:"Pourquoi un lecteur de fichier CNAF\xa0?",text:Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("p",{className:h.a.text,children:"Tous les d\xe9partements n'ont pas les outils pour analyser les fichiers envoy\xe9s par la CNAF. Cela peut ralentir et compliquer nos \xe9changes."}),Object(i.jsx)("p",{className:h.a.text,children:"Avec cet outil, nous souhaitons permettre aux personnes qui ont acc\xe8s \xe0 ces fichiers d'en extraire des statistiques g\xe9n\xe9rales sans avoir \xe0 mettre les mains dans le camboui elles-m\xeame."}),Object(i.jsx)("p",{className:h.a.text,children:"Aujourd'hui, nous cherchons \xe0 comprendre pourquoi pour la CNAF 90% des dossiers pr\xe9sents dans les fichiers quotidiens d'instructions contiennent des emails alors que ce taux est de 30% \xe0 50% pour certains d\xe9partements."})]})})]})]})}},jwbB:function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return c}));var i=n("BsWD");function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e)){var n=[],i=!0,a=!1,r=void 0;try{for(var c,s=e[Symbol.iterator]();!(i=(c=s.next()).done)&&(n.push(c.value),!t||n.length!==t);i=!0);}catch(l){a=!0,r=l}finally{try{i||null==s.return||s.return()}finally{if(a)throw r}}return n}}(e,t)||Object(i.a)(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var r=function(e){var t=a(e.split("/"),3),n=t[0],i=t[1],r=t[2];return new Date(r,i-1,n)};function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=e.getFullYear(),n=e.getMonth()+1,i=e.getDate(),a=e.getHours(),r=e.getMinutes(),c=e.getSeconds();return t+"_"+n+"_"+i+"_"+a+"_"+r+"_"+c}function s(e){var t=e.getFullYear(),n=e.getMonth()+1;return e.getDate()+"/"+n+"/"+t}}},[["3Ztg",0,2,1,3,4]]]);